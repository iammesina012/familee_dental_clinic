<!-- Generated by SpecStory -->

# Plan staff account UI setup (2025-09-23 17:51Z)

_**User (2025-09-23 14:50Z)**_

okay so this chat is for setting up the staff account with its own UI. beroe we code taht, of course we need to plan it first before we code. because i dont have any idea how to pull this up?

---

_**Assistant**_

I'll help you plan the staff account UI setup. Let me first understand the current codebase structure and then we can plan the staff account feature together.


---

<details>
                <summary>Searched codebase "How is user authentication and account management currently implemented?" • **15** results</summary>
            
| File | Lines |
|------|-------|
| `lib/features/auth/services/auth_service.dart` | Lundefined-51 |
| `lib/features/settings/controller/add_user_controller.dart` | Lundefined-65 |
| `lib/features/auth/services/auth_service.dart` | L48-114 |
| `lib/features/auth/services/auth_service.dart` | L109-173 |
| `lib/features/auth/controller/login_controller.dart` | L60-125 |
| `lib/features/settings/controller/user_list_controller.dart` | Lundefined-46 |
| `lib/features/settings/controller/edit_user_controller.dart` | Lundefined-52 |
| `lib/features/auth/controller/login_controller.dart` | Lundefined-63 |
| `lib/features/auth/services/auth_service.dart` | L169-198 |
| `lib/features/settings/controller/change_password_controller.dart` | Lundefined-63 |
| `lib/features/settings/controller/edit_user_controller.dart` | L45-126 |
| `lib/features/settings/controller/user_list_controller.dart` | L42-110 |
| `lib/features/auth/pages/login_page.dart` | Lundefined-37 |
| `lib/features/settings/pages/add_user_page.dart` | L403-474 |
| `lib/features/settings/pages/choose_account_page.dart` | Lundefined-34 |

</details>

---

<details>
                <summary>Searched codebase "What are the different user roles and permissions in the system?" • **15** results</summary>
            
| File | Lines |
|------|-------|
| `lib/features/settings/controller/add_user_controller.dart` | Lundefined-65 |
| `lib/features/settings/controller/user_list_controller.dart` | L104-167 |
| `lib/features/settings/controller/user_list_controller.dart` | Lundefined-46 |
| `lib/features/settings/controller/edit_user_controller.dart` | L45-126 |
| `lib/features/settings/controller/edit_user_controller.dart` | Lundefined-52 |
| `lib/features/settings/controller/edit_user_controller.dart` | L121-195 |
| `lib/features/auth/services/auth_service.dart` | Lundefined-51 |
| `lib/features/settings/controller/add_user_controller.dart` | L59-115 |
| `lib/features/settings/controller/user_list_controller.dart` | L42-110 |
| `lib/features/settings/controller/edit_user_controller.dart` | L188-239 |
| `lib/features/settings/pages/edit_user_page.dart` | L477-537 |
| `lib/features/auth/services/auth_service.dart` | L48-114 |
| `lib/features/settings/pages/edit_user_page.dart` | Lundefined-65 |
| `lib/features/settings/pages/user_list_page.dart` | L217-245 |
| `lib/features/auth/services/auth_service.dart` | L109-173 |

</details>

---

<details>
                <summary>Searched codebase "What is the main dashboard and navigation structure for different user types?" • **15** results</summary>
            
| File | Lines |
|------|-------|
| `lib/main.dart` | L86-139 |
| `lib/main.dart` | L47-88 |
| `lib/shared/drawer.dart` | Lundefined-46 |
| `lib/features/dashboard/pages/dashboard_page.dart` | L52-90 |
| `lib/features/dashboard/pages/dashboard_page.dart` | Lundefined-55 |
| `lib/main.dart` | Lundefined-27 |
| `lib/features/auth/controller/login_controller.dart` | L60-125 |
| `lib/shared/drawer.dart` | L43-97 |
| `lib/shared/drawer.dart` | L94-156 |
| `lib/features/dashboard/pages/dashboard_page.dart` | L86-137 |
| `lib/features/settings/pages/settings_page.dart` | L93-154 |
| `lib/features/auth/services/auth_service.dart` | Lundefined-51 |
| `lib/features/inventory/pages/inventory_page.dart` | Lundefined-45 |
| `lib/features/purchase_order/pages/purchase_order_page.dart` | Lundefined-48 |
| `lib/features/inventory/pages/inventory_page.dart` | L153-191 |

</details>

---

Read file: undefined

---

Now let me create a comprehensive plan for the staff account UI setup. Based on my analysis of the codebase, I can see you have a well-structured Flutter app with Firebase authentication, user roles, and a comprehensive navigation system.


---

## Todo List

- [-] Plan staff account UI structure and permissions
- [ ] Create staff-specific dashboard with limited features
- [ ] Design staff navigation drawer with restricted access
- [ ] Implement role-based access control for staff users
- [ ] Create staff-specific UI components and pages

---

## Staff Account UI Planning

Based on your codebase analysis, here's a comprehensive plan for setting up the staff account with its own UI:

### **Current System Analysis:**
- ✅ **Authentication System**: Firebase Auth with role-based access
- ✅ **User Roles**: Admin and Staff roles already implemented
- ✅ **Navigation**: Centralized drawer system
- ✅ **Dashboard**: Main dashboard with analytics

### **Staff Account UI Plan:**

#### **1. Staff Dashboard Features (Limited Access)**
**What Staff CAN do:**
- View inventory (read-only)
- View purchase orders (read-only) 
- View stock deductions (read-only)
- View activity logs (read-only)
- Basic notifications

**What Staff CANNOT do:**
- Create/edit users (Admin only)
- System settings (Admin only)
- Backup/restore (Admin only)
- Advanced analytics (Admin only)

#### **2. Staff Navigation Structure**
```
Staff Drawer:
├── Dashboard (simplified)
├── Inventory (view only)
├── Purchase Orders (view only)
├── Stock Deduction (view only)
├── Activity Log (view only)
├── Notifications
└── Logout
```

#### **3. Implementation Strategy**

**Option A: Role-Based UI Switching**
- Single app with conditional UI based on user role
- Show/hide features based on permissions
- Different dashboard layouts per role

**Option B: Separate Staff App**
- Completely separate Flutter app for staff
- Shared backend but different UI
- Simpler but requires more maintenance

**Option C: Modular UI Components**
- Shared components with role-based rendering
- Conditional feature loading
- Most flexible approach

#### **4. Technical Implementation Plan**

1. **Role Detection Service**
   - Check user role on login
   - Store role in app state
   - Route to appropriate dashboard

2. **Staff Dashboard**
   - Simplified version of main dashboard
   - Only essential widgets
   - Read-only indicators

3. **Permission Guards**
   - Route guards for admin-only pages
   - UI element visibility controls
   - Action button restrictions

4. **Staff-Specific Components**
   - Read-only data tables
   - Limited action buttons
   - Staff-friendly messaging

### **Questions for You:**

1. **Which approach do you prefer?**
   - Role-based UI switching (single app)
   - Separate staff app
   - Modular components

2. **Staff Permissions:**
   - Should staff be able to create stock deductions?
   - Should they see all purchase orders or only assigned ones?
   - Any specific features you want to restrict?

3. **UI Design:**
   - Should staff UI look different (colors, layout)?
   - Any specific branding for staff accounts?

4. **Data Access:**
   - Should staff see all inventory or filtered views?
   - Any department-based restrictions?

Let me know your preferences and I'll start implementing the staff account UI system! [[memory:6502860]]

---

_**User (2025-09-23 14:50Z)**_

how will you code this, im ean most likely ill do the Option A which is the role based. but how like if else? what do you think?

---

_**Assistant**_

Great choice! Option A (role-based UI switching) is the most practical approach. Let me show you exactly how I'd implement this with a clean, maintainable structure.


---

## Todo List

- [x] Plan staff account UI structure and permissions
- [ ] Create staff-specific dashboard with limited features
- [ ] Design staff navigation drawer with restricted access
- [ ] Implement role-based access control for staff users
- [ ] Create staff-specific UI components and pages
- [-] Create role detection service and user state management
- [ ] Implement permission guards and conditional UI rendering

---

## How I'll Code the Role-Based UI System

Here's my implementation strategy using **clean if-else logic** with **service-based architecture**:

### **1. User Role Service (Core Logic)**
```dart
// lib/shared/services/user_role_service.dart
class UserRoleService {
  static String? _currentUserRole;
  
  static Future<String> getCurrentUserRole() async {
    if (_currentUserRole != null) return _currentUserRole!;
    
    final user = FirebaseAuth.instance.currentUser;
    if (user == null) return 'Staff'; // Default
    
    final doc = await FirebaseFirestore.instance
        .collection('user_roles')
        .doc(user.uid)
        .get();
    
    _currentUserRole = doc.data()?['role'] ?? 'Staff';
    return _currentUserRole!;
  }
  
  static bool isAdmin() => _currentUserRole == 'Admin';
  static bool isStaff() => _currentUserRole == 'Staff';
}
```

### **2. Conditional Dashboard Rendering**
```dart
// lib/features/dashboard/pages/dashboard_page.dart
class Dashboard extends StatefulWidget {
  @override
  Widget build(BuildContext context) {
    return FutureBuilder<String>(
      future: UserRoleService.getCurrentUserRole(),
      builder: (context, snapshot) {
        if (!snapshot.hasData) return LoadingWidget();
        
        final userRole = snapshot.data!;
        
        // ROLE-BASED RENDERING
        if (userRole == 'Admin') {
          return AdminDashboard();
        } else {
          return StaffDashboard();
        }
      },
    );
  }
}
```

### **3. Conditional Navigation Drawer**
```dart
// lib/shared/drawer.dart
class MyDrawer extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return FutureBuilder<String>(
      future: UserRoleService.getCurrentUserRole(),
      builder: (context, snapshot) {
        if (!snapshot.hasData) return SizedBox();
        
        final userRole = snapshot.data!;
        
        return Drawer(
          child: Column(
            children: [
              // Common items for all users
              _buildCommonItems(context),
              
              // ROLE-BASED ITEMS
              if (userRole == 'Admin') ...[
                _buildAdminOnlyItems(context),
              ],
              
              if (userRole == 'Staff') ...[
                _buildStaffOnlyItems(context),
              ],
              
              // Common bottom items
              _buildBottomItems(context),
            ],
          ),
        );
      },
    );
  }
}
```

### **4. Permission-Based Widget Wrapper**
```dart
// lib/shared/widgets/permission_wrapper.dart
class PermissionWrapper extends StatelessWidget {
  final Widget child;
  final List<String> allowedRoles;
  
  const PermissionWrapper({
    required this.child,
    required this.allowedRoles,
  });
  
  @override
  Widget build(BuildContext context) {
    return FutureBuilder<String>(
      future: UserRoleService.getCurrentUserRole(),
      builder: (context, snapshot) {
        if (!snapshot.hasData) return SizedBox();
        
        final userRole = snapshot.data!;
        
        // SIMPLE IF-ELSE LOGIC
        if (allowedRoles.contains(userRole)) {
          return child;
        } else {
          return AccessDeniedWidget();
        }
      },
    );
  }
}
```

### **5. Usage Examples**

**In Dashboard:**
```dart
// Show admin-only analytics
PermissionWrapper(
  allowedRoles: ['Admin'],
  child: AdminAnalyticsWidget(),
)

// Show staff-only simplified view
PermissionWrapper(
  allowedRoles: ['Staff'],
  child: StaffInventoryView(),
)
```

**In Settings Page:**
```dart
// Admin-only user management
if (UserRoleService.isAdmin()) {
  UserManagementSection(),
} else {
  StaffProfileSection(),
}
```

**In Navigation:**
```dart
// Conditional drawer items
if (userRole == 'Admin') {
  _buildDrawerItem(icon: Icons.admin_panel_settings, text: 'User Management'),
  _buildDrawerItem(icon: Icons.backup, text: 'Backup & Restore'),
}

if (userRole == 'Staff') {
  _buildDrawerItem(icon: Icons.inventory, text: 'View Inventory'),
  _buildDrawerItem(icon: Icons.history, text: 'Activity Log'),
}
```

### **6. Clean Implementation Pattern**

**Instead of complex nested if-else, I'll use:**

1. **Service Layer** - Handle role detection
2. **Widget Wrappers** - Handle conditional rendering  
3. **FutureBuilder** - Handle async role loading
4. **Simple if statements** - Handle role-based logic

**Example Structure:**
```dart
// Clean, readable if-else pattern
Widget buildDashboard() {
  return FutureBuilder<String>(
    future: UserRoleService.getCurrentUserRole(),
    builder: (context, snapshot) {
      final role = snapshot.data ?? 'Staff';
      
      if (role == 'Admin') {
        return AdminDashboard();
      } else if (role == 'Staff') {
        return StaffDashboard();
      } else {
        return DefaultDashboard();
      }
    },
  );
}
```

### **Benefits of This Approach:**
- ✅ **Simple if-else logic** (easy to understand)
- ✅ **Reusable components** (PermissionWrapper)
- ✅ **Clean separation** (service layer)
- ✅ **Maintainable** (easy to add new roles)
- ✅ **Performance** (cached role detection)

**Would you like me to start implementing this structure?** I can begin with the UserRoleService and then move to the conditional dashboard rendering.

---

